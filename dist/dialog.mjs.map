{"version":3,"file":"dialog.mjs","sources":["../src/defaults.js","../src/focus-trap.js","../src/index.js","../src/emitter.js"],"sourcesContent":["/**\n * Default configuration.\n *\n * @property {string} label - ID of HTMLElement to use as label or a string.\n * @property {string} description - ID of HTMLElement to use as aria-describedby.\n * @property {boolean} alert - Set dialog role to alertdialog.\n * @property {string} openClass - The class applied to elements.dialog when open.\n */\nconst defaults = {\n\tlabel: 'Dialog',\n\tdescription: '',\n\talert: false,\n\topenClass: 'is-open',\n};\n\nexport default defaults;\n","const selectors = [\n\t'[contenteditable]',\n\t'[tabindex]:not([tabindex^=\"-\"])',\n\t'a[href]',\n\t'area[href]',\n\t'button:not([disabled])',\n\t'embed',\n\t'iframe',\n\t'input:not([disabled])',\n\t'object',\n\t'select:not([disabled])',\n\t'textarea:not([disabled])'\n];\n\nfunction isVisible(element) {\n\tconst isHidden = !(element.offsetWidth || element.offsetHeight || element.getClientRects().length);\n\tconst isInvisible = window.getComputedStyle(element).visibility === 'hidden';\n\n\treturn !(isHidden || isInvisible);\n}\n\nfunction getFocusableElements(node) {\n\treturn [...node.querySelectorAll(selectors)].filter(elem => isVisible(elem));\n}\n\nfunction focus(node) {\n\tif (node && node.focus) node.focus();\n}\n\nfunction focusFirstElement(node) {\n\tconst nodes = getFocusableElements(node);\n\tif (nodes.length) focus(nodes[0]);\n}\n\nfunction trapTab(element, event) {\n\tconst activeElement = document.activeElement;\n\n\tconst elements = getFocusableElements(element);\n\tconst firstTabStop = elements[0];\n\tconst lastTabStop = elements[elements.length - 1];\n\n\tif (event.shiftKey && activeElement === firstTabStop) {\n\t\tfocus(lastTabStop);\n\t\tevent.preventDefault();\n\t}\n\n\tif (!event.shiftKey && activeElement === lastTabStop) {\n\t\tfocus(firstTabStop);\n\t\tevent.preventDefault();\n\t}\n}\n\nfunction focusTrap(element, initialElement) {\n\tlet trapActivated = false;\n\tlet initialActiveElement = undefined;\n\n\tfunction onFocus(event) {\n\t\tconst focusLost = !element.contains(document.activeElement);\n\t\tevent.preventDefault();\n\t\tevent.stopImmediatePropagation();\n\t\tif (focusLost && trapActivated) focusFirstElement(element);\n\t}\n\n\tfunction onKeydown(event) {\n\t\tif (event.key === 'Tab') trapTab(element, event);\n\t}\n\n\tfunction activate() {\n\t\tif (trapActivated) return;\n\n\t\ttrapActivated = true;\n\t\tinitialActiveElement = document.activeElement;\n\n\t\tif (initialElement && element.contains(initialElement)) {\n\t\t\tfocus(initialElement);\n\t\t} else {\n\t\t\tfocusFirstElement(element);\n\t\t}\n\n\t\tdocument.addEventListener('focus', onFocus, true);\n\t\tdocument.addEventListener('keydown', onKeydown, true);\n\t}\n\n\tfunction deactivate() {\n\t\tif (!trapActivated) return;\n\n\t\ttrapActivated = false;\n\t\tfocus(initialActiveElement);\n\t\tinitialActiveElement = undefined;\n\n\t\tdocument.removeEventListener('focus', onFocus, true);\n\t\tdocument.removeEventListener('keydown', onKeydown, true);\n\t}\n\n\treturn { activate, deactivate }\n\n}\n\nexport default focusTrap;\n","import defaults from './defaults';\nimport emitter from './emitter';\nimport focusTrap from './focus-trap';\n\nexport function dialog(dialog, main, options) {\n\n\tconst elements = {\n\t\tmain: document.getElementById(main),\n\t\tdialog: document.getElementById(dialog),\n\t};\n\n\tlet events = emitter();\n\n\tif (!elements.dialog) {\n\t\tthrow new Error(`No element with the id \"${dialog}\"`);\n\t}\n\n\tif (!elements.main) {\n  \tthrow new Error(`No element with the id \"${main}\"`);\n  }\n\n\tconst config = Object.assign({}, defaults, options);\n\tconst trap = focusTrap(elements.dialog, config.focus);\n\n\tlet isOpen = false;\n\tlet initiated = false;\n\n\tfunction onKeydown(event) {\n\t\tif (event.key === 'Escape') close();\n\t}\n\n\t/**\n\t * Create\n\t */\n\tfunction create() {\n\t\tconst role = config.alert ? 'alertdialog' : 'dialog';\n\t\tconst labeledby = document.getElementById(config.label);\n\t\tconst attr = labeledby ? 'labeledby' : 'label';\n\n\t\telements.main.setAttribute('aria-hidden', false);\n\n\t\telements.dialog.setAttribute('role', role);\n\t\telements.dialog.setAttribute('aria-modal', true);\n\t\telements.dialog.setAttribute(`aria-${attr}`, config.label);\n\t\telements.dialog.setAttribute('aria-hidden', true);\n\n\t\tif (document.getElementById(config.description)) {\n\t\t\telements.dialog.setAttribute('aria-describedby', config.description);\n\t\t} else if (config.description) {\n\t\t\tthrow new Error(`Invalid element: No element with the id \"${config.description}\"`);\n\t\t}\n\n\t\tif (elements.main.contains(elements.dialog)) {\n\t\t\tdocument.body.appendChild(elements.dialog);\n\t\t}\n\n\t\tinitiated = true;\n\n\t\tevents.emit('create', elements.dialog);\n\t}\n\n\t/**\n\t * Open\n\t */\n\tfunction open() {\n\t\tif (isOpen || !initiated) return;\n\n\t\tisOpen = true;\n\n\t\telements.main.setAttribute('aria-hidden', true);\n\t\telements.dialog.setAttribute('aria-hidden', false);\n\n\t\telements.dialog.classList.add(config.openClass);\n\t\tevents.emit('open', elements.dialog);\n\n\t\tdocument.addEventListener('keydown', onKeydown, true);\n\n\t\ttrap.activate();\n\t}\n\n\t/**\n\t * Close\n\t */\n\tfunction close() {\n\t\tif (!isOpen || !initiated) return;\n\n\t\ttrap.deactivate();\n\n\t\tisOpen = false;\n\n\t\telements.main.setAttribute('aria-hidden', false);\n\t\telements.dialog.setAttribute('aria-hidden', true);\n\n\t\tdocument.removeEventListener('keydown', onKeydown, true);\n\n\t\telements.dialog.classList.remove(config.openClass);\n\t\tevents.emit('close', elements.dialog);\n\t}\n\n\t/**\n\t * Toggle\n\t */\n\tfunction toggle(toggle = !isOpen) {\n\t\ttoggle ? open() : close();\n\t}\n\n\t/**\n\t * Destroy\n\t */\n\tfunction destroy() {\n\t\tconst attributes = [ 'aria-describedby', 'aria-label', 'aria-labeledby', 'aria-modal', 'role' ];\n\n\t\tclose();\n\t\tinitiated = false;\n\t\tattributes.forEach(attr => elements.dialog.removeAttribute(attr));\n\t\tevents.emit('destroy', elements.dialog);\n\t}\n\n\treturn { elements, create, destroy, open, close, toggle, isOpen, on: events.on, off: events.off };\n}\n","export default function emitter() {\n\tconst events = Object.create(null);\n\treturn {\n\t\t/**\n\t\t * Subscribe to an event\n\t\t * @param {String} type\n\t\t * @param {Function} handler\n\t\t */\n\t\ton(type, handler) {\n\t\t\tif (type && handler) {\n\t\t\t\tconst handlers = events[type] = events[type] || [];\n\t\t\t\tif (handlers.indexOf(handler) == -1) {\n\t\t\t\t\thandlers.push(handler);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Unsubscribe from an event\n\t\t * @param {String} event\n\t\t * @param {Function} handler\n\t\t */\n\t\toff(event, handler = false) {\n\t\t\tif (handler) {\n\t\t\t\tevents[event].splice(events[event].indexOf(handler), 1);\n\t\t\t} else {\n\t\t\t\tdelete events[event];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Emit an event\n\t\t * @param {String} event\n\t\t * @param {*} args\n\t\t */\n\t\temit(event, ...args) {\n\t\t\t(events[event] || []).forEach(handler => handler.apply(handler, args));\n\t\t},\n\t}\n}\n"],"names":["const","defaults","label","description","alert","openClass","selectors","getFocusableElements","node","querySelectorAll","filter","elem","isHidden","element","offsetWidth","offsetHeight","getClientRects","length","isInvisible","window","getComputedStyle","visibility","focus","focusFirstElement","nodes","dialog","main","options","elements","document","getElementById","events","Object","create","on","type","handler","handlers","indexOf","push","off","event","splice","emit","forEach","apply","args","emitter","Error","config","assign","trap","initialElement","trapActivated","initialActiveElement","undefined","onFocus","focusLost","contains","activeElement","preventDefault","stopImmediatePropagation","onKeydown","key","firstTabStop","lastTabStop","shiftKey","trapTab","addEventListener","removeEventListener","focusTrap","isOpen","initiated","close","open","setAttribute","classList","add","activate","deactivate","remove","role","attr","body","appendChild","removeAttribute","toggle"],"mappings":"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"}