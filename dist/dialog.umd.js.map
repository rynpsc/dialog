{"version":3,"file":"dialog.umd.js","sources":["../src/defaults.js","../src/focus-trap.js","../src/index.js"],"sourcesContent":["/**\n * Default configuration.\n *\n * @property {string} label - ID of HTMLElement to use as label or a string.\n * @property {string} description - ID of HTMLElement to use as aria-describedby.\n * @property {boolean} alert - Set dialog role to alertdialog.\n * @property {string} openClass - The class applied to elements.dialog when open.\n */\nconst defaults = {\n\tlabel: 'Dialog',\n\tdescription: '',\n\talert: false,\n\topenClass: 'is-open',\n};\n\nexport default defaults;\n","const selectors = [\n\t'[contenteditable]',\n\t'[tabindex]:not([tabindex^=\"-\"])',\n\t'a[href]',\n\t'area[href]',\n\t'button:not([disabled])',\n\t'embed',\n\t'iframe',\n\t'input:not([disabled])',\n\t'object',\n\t'select:not([disabled])',\n\t'textarea:not([disabled])'\n];\n\nfunction isVisible(element) {\n\tconst isHidden = !(element.offsetWidth || element.offsetHeight || element.getClientRects().length);\n\tconst isInvisible = window.getComputedStyle(element).visibility === 'hidden';\n\n\treturn !(isHidden || isInvisible);\n}\n\nfunction getFocusableElements(node) {\n\treturn [...node.querySelectorAll(selectors)].filter(elem => isVisible(elem));\n}\n\nfunction focus(node) {\n\tif (node && node.focus) node.focus();\n}\n\nfunction focusFirstElement(node) {\n\tconst nodes = getFocusableElements(node);\n\tif (nodes.length) focus(nodes[0]);\n}\n\nfunction trapTab(element, event) {\n\tconst activeElement = document.activeElement;\n\n\tconst elements = getFocusableElements(element);\n\tconst firstTabStop = elements[0];\n\tconst lastTabStop = elements[elements.length - 1];\n\n\tif (event.shiftKey && activeElement === firstTabStop) {\n\t\tfocus(lastTabStop);\n\t\tevent.preventDefault();\n\t}\n\n\tif (!event.shiftKey && activeElement === lastTabStop) {\n\t\tfocus(firstTabStop);\n\t\tevent.preventDefault();\n\t}\n}\n\nfunction focusTrap(element, initialElement) {\n\tlet trapActivated = false;\n\tlet initialActiveElement = undefined;\n\n\tfunction onFocus(event) {\n\t\tconst focusLost = !element.contains(document.activeElement);\n\t\tevent.preventDefault();\n\t\tevent.stopImmediatePropagation();\n\t\tif (focusLost && trapActivated) focusFirstElement(element);\n\t}\n\n\tfunction onKeydown(event) {\n\t\tif (event.key === 'Tab') trapTab(element, event);\n\t}\n\n\tfunction activate() {\n\t\tif (trapActivated) return;\n\n\t\ttrapActivated = true;\n\t\tinitialActiveElement = document.activeElement;\n\n\t\tif (initialElement && element.contains(initialElement)) {\n\t\t\tfocus(initialElement);\n\t\t} else {\n\t\t\tfocusFirstElement(element);\n\t\t}\n\n\t\tdocument.addEventListener('focus', onFocus, true);\n\t\tdocument.addEventListener('keydown', onKeydown, true);\n\t}\n\n\tfunction deactivate() {\n\t\tif (!trapActivated) return;\n\n\t\ttrapActivated = false;\n\t\tfocus(initialActiveElement);\n\t\tinitialActiveElement = undefined;\n\n\t\tdocument.removeEventListener('focus', onFocus, true);\n\t\tdocument.removeEventListener('keydown', onKeydown, true);\n\t}\n\n\treturn { activate, deactivate }\n\n}\n\nexport default focusTrap;\n","import defaults from './defaults';\nimport focusTrap from './focus-trap';\n\nexport function dialog(dialog, main, options) {\n\n\tconst elements = {\n\t\tmain: document.getElementById(main),\n\t\tdialog: document.getElementById(dialog),\n\t};\n\n\tif (!elements.dialog) {\n\t\tthrow new Error(`No element with the id \"${dialog}\"`);\n\t}\n\n\tif (!elements.main) {\n\t\tthrow new Error(`No element with the id \"${main}\"`);\n\t}\n\n\tconst config = Object.assign({}, defaults, options);\n\tconst trap = focusTrap(elements.dialog, config.focus);\n\n\tlet isOpen = false;\n\tlet initiated = false;\n\n\tfunction onKeydown(event) {\n\t\tif (event.key === 'Escape') close();\n\t}\n\n\t/**\n\t * Create\n\t */\n\tfunction create() {\n\t\tconst role = config.alert ? 'alertdialog' : 'dialog';\n\t\tconst labeledby = document.getElementById(config.label);\n\t\tconst attr = labeledby ? 'labeledby' : 'label';\n\n\t\telements.main.setAttribute('aria-hidden', false);\n\n\t\telements.dialog.setAttribute('role', role);\n\t\telements.dialog.setAttribute('aria-modal', true);\n\t\telements.dialog.setAttribute(`aria-${attr}`, config.label);\n\t\telements.dialog.setAttribute('aria-hidden', true);\n\n\t\tif (document.getElementById(config.description)) {\n\t\t\telements.dialog.setAttribute('aria-describedby', config.description);\n\t\t} else if (config.description) {\n\t\t\tthrow new Error(`Invalid element: No element with the id \"${config.description}\"`);\n\t\t}\n\n\t\tif (elements.main.contains(elements.dialog)) {\n\t\t\tdocument.body.appendChild(elements.dialog);\n\t\t}\n\n\t\tinitiated = true;\n\n\t\tdispatchEvent('create');\n\t}\n\n\t/**\n\t * Open\n\t */\n\tfunction open() {\n\t\tif (isOpen || !initiated) return;\n\n\t\tif (!dispatchEvent('open')) {\n\t\t\treturn;\n\t\t}\n\n\t\tisOpen = true;\n\n\t\telements.main.setAttribute('aria-hidden', true);\n\t\telements.dialog.setAttribute('aria-hidden', false);\n\n\t\telements.dialog.classList.add(config.openClass);\n\n\t\tdocument.addEventListener('keydown', onKeydown, true);\n\n\t\ttrap.activate();\n\t}\n\n\t/**\n\t * Close\n\t */\n\tfunction close() {\n\t\tif (!isOpen || !initiated) return;\n\n\t\tif (!dispatchEvent('close')) {\n\t\t\treturn;\n\t\t}\n\n\t\ttrap.deactivate();\n\n\t\tisOpen = false;\n\n\t\telements.main.setAttribute('aria-hidden', false);\n\t\telements.dialog.setAttribute('aria-hidden', true);\n\n\t\tdocument.removeEventListener('keydown', onKeydown, true);\n\n\t\telements.dialog.classList.remove(config.openClass);\n\t}\n\n\t/**\n\t * Toggle\n\t */\n\tfunction toggle(toggle = !isOpen) {\n\t\ttoggle ? open() : close();\n\t}\n\n\t/**\n\t * Destroy\n\t */\n\tfunction destroy() {\n\t\tconst attributes = [ 'aria-describedby', 'aria-label', 'aria-labeledby', 'aria-modal', 'role' ];\n\n\t\tclose();\n\t\tinitiated = false;\n\t\tattributes.forEach(attr => elements.dialog.removeAttribute(attr));\n\t\tdispatchEvent('destroy');\n\t}\n\n\t/**\n\t * Wrapper method to add an event listener.\n\t *\n\t * @param {string} type\n\t * @param {function} handler\n\t */\n\tfunction on(type, handler) {\n\t\telements.dialog.addEventListener(type, handler);\n\t}\n\n\t/**\n\t * Wrapper method to remove an event listener.\n\t *\n\t * @param {string} type\n\t * @param {function} handler\n\t */\n\tfunction off(type, handler) {\n\t\telements.dialog.removeEventListener(type, handler);\n\t}\n\n\t/**\n\t * Dispatches a custom event.\n\t *\n\t * @param {string} name - The event name.\n\t * @returns {boolean} False if preventDefault() was called, true otherwise.\n\t */\n\tfunction dispatchEvent(name) {\n\t\tconst event = new CustomEvent(name, {\n\t\t\tbubbles: true,\n\t\t\tcancelable: true,\n\t\t});\n\n\t\treturn elements.dialog.dispatchEvent(event);\n\t}\n\n\treturn { elements, create, destroy, open, close, toggle, isOpen, on, off };\n}\n"],"names":["const","defaults","label","description","alert","openClass","selectors","getFocusableElements","node","querySelectorAll","filter","elem","isHidden","element","offsetWidth","offsetHeight","getClientRects","length","isInvisible","window","getComputedStyle","visibility","focus","focusFirstElement","nodes","dialog","main","options","elements","document","getElementById","Error","config","Object","assign","trap","initialElement","trapActivated","initialActiveElement","undefined","onFocus","event","focusLost","contains","activeElement","preventDefault","stopImmediatePropagation","onKeydown","key","firstTabStop","lastTabStop","shiftKey","trapTab","addEventListener","removeEventListener","focusTrap","isOpen","initiated","close","open","dispatchEvent","setAttribute","classList","add","activate","deactivate","remove","name","CustomEvent","bubbles","cancelable","role","attr","body","appendChild","forEach","removeAttribute","toggle","type","handler"],"mappings":"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"}